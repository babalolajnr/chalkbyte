name: Chalkbyte API
profiles:
  local:
    name: Local Development
    data:
      host: http://localhost:3000
      api_token: "{{ response('login_user') | jsonpath('$.access_token') }}"
requests:
  tag/Authentication:
    name: Authentication
    requests:
      forgot_password:
        name: Request password reset email
        method: POST
        url: "{{ host }}/api/auth/forgot-password"
        body:
          type: json
          data:
            email: user@example.com
      login_user:
        name: Login and receive JWT token or MFA challenge
        method: POST
        url: "{{ host }}/api/auth/login"
        body:
          type: json
          data:
            email: "babalolajnr@gmail.com"
            password: Password@123
      logout:
        name: Logout and revoke all refresh tokens
        method: POST
        url: "{{ host }}/api/auth/logout"
        authentication:
          type: bearer
          token: "{{ api_token }}"
      verify_mfa_recovery_login:
        name: Use recovery code to complete login
        method: POST
        url: "{{ host }}/api/auth/mfa/recovery"
        body:
          type: json
          data:
            recovery_code: ABCD1234
            temp_token: "{{ response('login_user') | jsonpath('$.temp_token') }}"
      verify_mfa_login:
        name: Verify MFA code and complete login
        method: POST
        url: "{{ host }}/api/auth/mfa/verify"
        body:
          type: json
          data:
            code: "531061"
            temp_token: "{{ response('login_user') | jsonpath('$.temp_token') }}"
      refresh_token:
        name: Refresh access token using refresh token
        method: POST
        url: "{{ host }}/api/auth/refresh"
        body:
          type: json
          data:
            refresh_token: ""
      reset_password:
        name: Reset password using token
        method: POST
        url: "{{ host }}/api/auth/reset-password"
        body:
          type: json
          data:
            new_password: newPassword123
            token: ""
  tag/Levels:
    name: Levels
    requests:
      get_levels:
        name: /api/levels
        method: GET
        url: "{{ host }}/api/levels"
        authentication:
          type: bearer
          token: "{{ api_token }}"
        query:
          name: ""
          pagination: ""
      create_level:
        name: /api/levels
        method: POST
        url: "{{ host }}/api/levels"
        body:
          type: json
          data:
            description: ""
            name: ""
        authentication:
          type: bearer
          token: "{{ api_token }}"
      remove_student_from_level:
        name: /api/levels/students/{student_id}
        method: DELETE
        url: "{{ host }}/api/levels/students/{{ student_id }}"
        authentication:
          type: bearer
          token: "{{ api_token }}"
      move_student_to_level:
        name: /api/levels/students/{student_id}/move
        method: PATCH
        url: "{{ host }}/api/levels/students/{{ student_id }}/move"
        body:
          type: json
          data:
            level_id: ""
        authentication:
          type: bearer
          token: "{{ api_token }}"
      delete_level:
        name: /api/levels/{id}
        method: DELETE
        url: "{{ host }}/api/levels/{{ id }}"
        authentication:
          type: bearer
          token: "{{ api_token }}"
      get_level_by_id:
        name: /api/levels/{id}
        method: GET
        url: "{{ host }}/api/levels/{{ id }}"
        authentication:
          type: bearer
          token: "{{ api_token }}"
      update_level:
        name: /api/levels/{id}
        method: PUT
        url: "{{ host }}/api/levels/{{ id }}"
        body:
          type: json
          data:
            description: ""
            name: ""
        authentication:
          type: bearer
          token: "{{ api_token }}"
      get_students_in_level:
        name: /api/levels/{id}/students
        method: GET
        url: "{{ host }}/api/levels/{{ id }}/students"
        authentication:
          type: bearer
          token: "{{ api_token }}"
      assign_students_to_level:
        name: /api/levels/{id}/students
        method: POST
        url: "{{ host }}/api/levels/{{ id }}/students"
        body:
          type: json
          data:
            student_ids:
              - ""
        authentication:
          type: bearer
          token: "{{ api_token }}"
  tag/MFA:
    name: MFA
    requests:
      disable_mfa:
        name: Disable MFA with password confirmation
        method: POST
        url: "{{ host }}/api/mfa/disable"
        body:
          type: json
          data:
            password: password123
        authentication:
          type: bearer
          token: "{{ api_token }}"
      enable_mfa:
        name: Enable MFA and get QR code
        method: POST
        url: "{{ host }}/api/mfa/enable"
        authentication:
          type: bearer
          token: "{{ api_token }}"
      regenerate_recovery_codes:
        name: Regenerate recovery codes
        method: POST
        url: "{{ host }}/api/mfa/recovery-codes/regenerate"
        authentication:
          type: bearer
          token: "{{ api_token }}"
      get_mfa_status:
        name: Get MFA enrollment status
        method: GET
        url: "{{ host }}/api/mfa/status"
        authentication:
          type: bearer
          token: "{{ api_token }}"
      verify_mfa:
        name: Verify MFA setup with TOTP code
        method: POST
        url: "{{ host }}/api/mfa/verify"
        body:
          type: json
          data:
            code: "123456"
        authentication:
          type: bearer
          token: "{{ api_token }}"
  tag/Schools:
    name: Schools
    requests:
      get_all_schools:
        name: /api/schools
        method: GET
        url: "{{ host }}/api/schools"
        authentication:
          type: bearer
          token: "{{ api_token }}"
        query:
          name: ""
          address: ""
          limit: ""
          offset: ""
      create_school:
        name: /api/schools
        method: POST
        url: "{{ host }}/api/schools"
        body:
          type: json
          data:
            address: ""
            name: ""
        authentication:
          type: bearer
          token: "{{ api_token }}"
      delete_school:
        name: /api/schools/{id}
        method: DELETE
        url: "{{ host }}/api/schools/{{ id }}"
        authentication:
          type: bearer
          token: "{{ api_token }}"
      get_school:
        name: /api/schools/{id}
        method: GET
        url: "{{ host }}/api/schools/{{ id }}"
        authentication:
          type: bearer
          token: "{{ api_token }}"
      get_school_admins:
        name: /api/schools/{id}/admins
        method: GET
        url: "{{ host }}/api/schools/{{ id }}/admins"
        authentication:
          type: bearer
          token: "{{ api_token }}"
        query:
          first_name: ""
          last_name: ""
          email: ""
          limit: ""
          offset: ""
      get_school_full_info:
        name: /api/schools/{id}/full-info
        method: GET
        url: "{{ host }}/api/schools/{{ id }}/full-info"
        authentication:
          type: bearer
          token: "{{ api_token }}"
      get_school_students:
        name: /api/schools/{id}/students
        method: GET
        url: "{{ host }}/api/schools/{{ id }}/students"
        authentication:
          type: bearer
          token: "{{ api_token }}"
        query:
          first_name: ""
          last_name: ""
          email: ""
          limit: ""
          offset: ""
  tag/Students:
    name: Students
    requests:
      get_students:
        name: /api/students
        method: GET
        url: "{{ host }}/api/students"
        authentication:
          type: bearer
          token: "{{ api_token }}"
        query:
          page: ""
          limit: ""
      create_student:
        name: /api/students
        method: POST
        url: "{{ host }}/api/students"
        body:
          type: json
          data:
            date_of_birth: ""
            email: ""
            first_name: ""
            grade_level: ""
            last_name: ""
            password: ""
        authentication:
          type: bearer
          token: "{{ api_token }}"
      delete_student:
        name: /api/students/{id}
        method: DELETE
        url: "{{ host }}/api/students/{{ id }}"
        authentication:
          type: bearer
          token: "{{ api_token }}"
      get_student:
        name: /api/students/{id}
        method: GET
        url: "{{ host }}/api/students/{{ id }}"
        authentication:
          type: bearer
          token: "{{ api_token }}"
      update_student:
        name: /api/students/{id}
        method: PUT
        url: "{{ host }}/api/students/{{ id }}"
        body:
          type: json
          data:
            date_of_birth: ""
            email: ""
            first_name: ""
            grade_level: ""
            last_name: ""
            password: ""
        authentication:
          type: bearer
          token: "{{ api_token }}"
  tag/Users:
    name: Users
    requests:
      get_users:
        name: Get all users with pagination and filtering (system admins see all, school admins see their school)
        method: GET
        url: "{{ host }}/api/users"
        authentication:
          type: bearer
          token: "{{ api_token }}"
        query:
          first_name: ""
          last_name: ""
          email: ""
          role: ""
          school_id: ""
          limit: ""
          offset: ""
      create_user:
        name: Create a new user (requires admin or system_admin role)
        method: POST
        url: "{{ host }}/api/users"
        body:
          type: json
          data:
            email: ""
            first_name: ""
            last_name: ""
            password: ""
            role: null
            school_id: ""
        authentication:
          type: bearer
          token: "{{ api_token }}"
      get_profile:
        name: Get current user profile from JWT token
        method: GET
        url: "{{ host }}/api/users/profile"
        authentication:
          type: bearer
          token: "{{ api_token }}"
      update_profile:
        name: Update current user profile (name only)
        method: PUT
        url: "{{ host }}/api/users/profile"
        body:
          type: json
          data:
            first_name: ""
            last_name: ""
        authentication:
          type: bearer
          token: "{{ api_token }}"
      change_password:
        name: Change current user password
        method: POST
        url: "{{ host }}/api/users/profile/change-password"
        body:
          type: json
          data:
            current_password: ""
            new_password: newPassword123
        authentication:
          type: bearer
          token: "{{ api_token }}"
