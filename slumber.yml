# yaml-language-server: $schema=https://raw.githubusercontent.com/LucasPickering/slumber/refs/tags/v4.2.1/schemas/collection.json

name: Chalkbyte API

profiles:
  local:
    name: Local Development
    data:
      host: http://localhost:3000
      access_token: ""
      refresh_token: ""
      temp_token: ""

  production:
    name: Production
    data:
      host: https://api.chalkbyte.com
      access_token: ""
      refresh_token: ""
      temp_token: ""

.auth_header:
  Authorization: "Bearer {{ response('auth.login') | jsonpath('$.access_token') }}"

requests:
  auth:
    name: Authentication
    requests:
      login:
        name: Login
        method: POST
        url: "{{ host }}/api/auth/login"
        body:
          type: json
          data:
            email: babalolajnrgmail.com
            password: Password@123

      mfa_verify:
        name: Verify MFA Code
        method: POST
        url: "{{ host }}/api/auth/mfa/verify"
        body:
          type: json
          data:
            temp_token: "{{ response('auth.login') | jsonpath('$.temp_token') }}"
            code: "123456"

      mfa_recovery:
        name: Verify MFA Recovery Code
        method: POST
        url: "{{ host }}/api/auth/mfa/recovery"
        body:
          type: json
          data:
            temp_token: "{{ response('auth.login') | jsonpath('$.temp_token') }}"
            recovery_code: "recovery-code-here"

      forgot_password:
        name: Forgot Password
        method: POST
        url: "{{ host }}/api/auth/forgot-password"
        body:
          type: json
          data:
            email: user@example.com

      reset_password:
        name: Reset Password
        method: POST
        url: "{{ host }}/api/auth/reset-password"
        body:
          type: json
          data:
            token: "reset-token-from-email"
            new_password: "newpassword123"

      refresh:
        name: Refresh Token
        method: POST
        url: "{{ host }}/api/auth/refresh"
        body:
          type: json
          data:
            refresh_token: "{{ response('auth.login') | jsonpath('$.refresh_token') }}"

      logout:
        name: Logout
        method: POST
        url: "{{ host }}/api/auth/logout"
        headers:
          $ref: "#/.auth_header"

  users:
    name: Users
    requests:
      create_user:
        name: Create User
        method: POST
        url: "{{ host }}/api/users"
        headers:
          $ref: "#/.auth_header"
        body:
          type: json
          data:
            first_name: John
            last_name: Doe
            email: john.doe@example.com
            password: password123
            role: student
            school_id: null

      list_users:
        name: List Users
        method: GET
        url: "{{ host }}/api/users"
        headers:
          $ref: "#/.auth_header"
        query:
          limit: "10"
          offset: "0"

      list_users_filtered:
        name: List Users (Filtered)
        method: GET
        url: "{{ host }}/api/users"
        headers:
          $ref: "#/.auth_header"
        query:
          first_name: John
          role: student
          limit: "20"
          offset: "0"

      get_profile:
        name: Get My Profile
        method: GET
        url: "{{ host }}/api/users/profile"
        headers:
          $ref: "#/.auth_header"

      update_profile:
        name: Update My Profile
        method: PUT
        url: "{{ host }}/api/users/profile"
        headers:
          $ref: "#/.auth_header"
        body:
          type: json
          data:
            first_name: Jane
            last_name: Smith

      change_password:
        name: Change Password
        method: POST
        url: "{{ host }}/api/users/profile/change-password"
        headers:
          $ref: "#/.auth_header"
        body:
          type: json
          data:
            current_password: oldpassword123
            new_password: newpassword456

  schools:
    name: Schools
    requests:
      create_school:
        name: Create School
        method: POST
        url: "{{ host }}/api/schools"
        headers:
          $ref: "#/.auth_header"
        body:
          type: json
          data:
            name: Springfield Elementary
            address: 742 Evergreen Terrace, Springfield

      list_schools:
        name: List All Schools
        method: GET
        url: "{{ host }}/api/schools"
        headers:
          $ref: "#/.auth_header"
        query:
          limit: "10"
          offset: "0"

      list_schools_filtered:
        name: List Schools (Filtered)
        method: GET
        url: "{{ host }}/api/schools"
        headers:
          $ref: "#/.auth_header"
        query:
          name: Elementary
          address: Springfield
          limit: "20"
          offset: "0"

      get_school:
        name: Get School by ID
        method: GET
        url: "{{ host }}/api/schools/{{ prompt(message='Enter school ID') }}"
        headers:
          $ref: "#/.auth_header"

      delete_school:
        name: Delete School
        method: DELETE
        url: "{{ host }}/api/schools/{{ prompt(message='Enter school ID') }}"
        headers:
          $ref: "#/.auth_header"

      get_school_students:
        name: Get School Students
        method: GET
        url: "{{ host }}/api/schools/{{ prompt(message='Enter school ID') }}/students"
        headers:
          $ref: "#/.auth_header"
        query:
          limit: "10"
          offset: "0"

      get_school_students_filtered:
        name: Get School Students (Filtered)
        method: GET
        url: "{{ host }}/api/schools/{{ prompt(message='Enter school ID') }}/students"
        headers:
          $ref: "#/.auth_header"
        query:
          first_name: John
          email: example.com
          limit: "20"
          offset: "0"

      get_school_admins:
        name: Get School Admins
        method: GET
        url: "{{ host }}/api/schools/{{ prompt(message='Enter school ID') }}/admins"
        headers:
          $ref: "#/.auth_header"
        query:
          limit: "10"
          offset: "0"

      get_school_full_info:
        name: Get School Full Info
        method: GET
        url: "{{ host }}/api/schools/{{ prompt(message='Enter school ID') }}/full-info"
        headers:
          $ref: "#/.auth_header"

  students:
    name: Students
    requests:
      create_student:
        name: Create Student
        method: POST
        url: "{{ host }}/api/students"
        headers:
          $ref: "#/.auth_header"
        body:
          type: json
          data:
            first_name: Alice
            last_name: Johnson
            email: alice.johnson@example.com
            date_of_birth: "2010-05-15"
            grade_level: "5"

      list_students:
        name: List Students
        method: GET
        url: "{{ host }}/api/students"
        headers:
          $ref: "#/.auth_header"
        query:
          page: "1"
          limit: "10"

      get_student:
        name: Get Student by ID
        method: GET
        url: "{{ host }}/api/students/{{ prompt(message='Enter student ID') }}"
        headers:
          $ref: "#/.auth_header"

      update_student:
        name: Update Student
        method: PUT
        url: "{{ host }}/api/students/{{ prompt(message='Enter student ID') }}"
        headers:
          $ref: "#/.auth_header"
        body:
          type: json
          data:
            first_name: Alice
            last_name: Johnson-Smith
            email: alice.jsmith@example.com
            date_of_birth: "2010-05-15"
            grade_level: "6"

      delete_student:
        name: Delete Student
        method: DELETE
        url: "{{ host }}/api/students/{{ prompt(message='Enter student ID') }}"
        headers:
          $ref: "#/.auth_header"

  mfa:
    name: MFA Management
    requests:
      get_mfa_status:
        name: Get MFA Status
        method: GET
        url: "{{ host }}/api/mfa/status"
        headers:
          $ref: "#/.auth_header"

      enable_mfa:
        name: Enable MFA
        method: POST
        url: "{{ host }}/api/mfa/enable"
        headers:
          $ref: "#/.auth_header"

      verify_mfa:
        name: Verify MFA Setup
        method: POST
        url: "{{ host }}/api/mfa/verify"
        headers:
          $ref: "#/.auth_header"
        body:
          type: json
          data:
            code: "123456"

      disable_mfa:
        name: Disable MFA
        method: POST
        url: "{{ host }}/api/mfa/disable"
        headers:
          $ref: "#/.auth_header"
        body:
          type: json
          data:
            password: password123

      regenerate_recovery_codes:
        name: Regenerate Recovery Codes
        method: POST
        url: "{{ host }}/api/mfa/recovery-codes/regenerate"
        headers:
          $ref: "#/.auth_header"
